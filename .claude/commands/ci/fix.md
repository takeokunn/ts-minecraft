# CI Fix ã‚³ãƒãƒ³ãƒ‰

CIå¤±æ•—ã‚’è‡ªå‹•ä¿®æ­£ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰

## ä½¿ç”¨ä¾‹

```bash
# æœ€æ–°ã®PRã®CIå¤±æ•—ã‚’ä¿®æ­£
claude "/ci/fix"

# ç‰¹å®šã®PRã®CIå¤±æ•—ã‚’ä¿®æ­£
claude "/ci/fix 123"

# è©³ç´°ãƒ­ã‚°ä»˜ãã§ä¿®æ­£
claude "/ci/fix --verbose"
```

## ä¿®æ­£å¯¾è±¡

### è‡ªå‹•ä¿®æ­£å¯èƒ½ãªå•é¡Œ

1. **ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé•å**
   - Prettierã«ã‚ˆã‚‹è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
   - ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆä¿®æ­£
   - æ”¹è¡Œã‚³ãƒ¼ãƒ‰çµ±ä¸€

2. **Lintã‚¨ãƒ©ãƒ¼**
   - oxlint --fix ã§ä¿®æ­£å¯èƒ½ãªå•é¡Œ
   - æœªä½¿ç”¨ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®å‰Šé™¤
   - ç°¡å˜ãªæ§‹æ–‡ã‚¨ãƒ©ãƒ¼

3. **å‹ã‚¨ãƒ©ãƒ¼ï¼ˆä¸€éƒ¨ï¼‰**
   - å‹ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®ä¿®æ­£
   - anyå‹ã®é©åˆ‡ãªå‹ã¸ã®ç½®æ›æ¡ˆæç¤º

### æ‰‹å‹•ä¿®æ­£ãŒå¿…è¦ãªå•é¡Œ

1. **ãƒ­ã‚¸ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼**
   - ãƒ†ã‚¹ãƒˆå¤±æ•—
   - ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ï¼ˆä¾å­˜é–¢ä¿‚ï¼‰

2. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡Œ**
   - è„†å¼±æ€§ã®ã‚ã‚‹ä¾å­˜é–¢ä¿‚
   - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼é•å

## å®Ÿè¡Œãƒ•ãƒ­ãƒ¼

```mermaid
graph TD
    A[CIå¤±æ•—æ¤œå‡º] --> B[ã‚¨ãƒ©ãƒ¼åˆ†æ]
    B --> C{è‡ªå‹•ä¿®æ­£å¯èƒ½?}
    C -->|Yes| D[è‡ªå‹•ä¿®æ­£å®Ÿè¡Œ]
    C -->|No| E[ä¿®æ­£æ¡ˆæç¤º]
    D --> F[å¤‰æ›´ã‚³ãƒŸãƒƒãƒˆ]
    F --> G[å†ãƒ—ãƒƒã‚·ãƒ¥]
    G --> H[CIå†å®Ÿè¡Œ]
    H --> I{æˆåŠŸ?}
    I -->|Yes| J[å®Œäº†]
    I -->|No| E
```

## å®Ÿè£…ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```bash
#!/bin/bash
set -euo pipefail

# PRç•ªå·å–å¾—
PR_NUMBER="${1:-$(gh pr list --author @me --limit 1 --json number --jq '.[0].number')}"

echo "ğŸ”§ PR #$PR_NUMBER ã®CIå¤±æ•—ã‚’ä¿®æ­£ä¸­..."

# å¤±æ•—ã—ãŸãƒã‚§ãƒƒã‚¯ã‚’å–å¾—
FAILED_CHECKS=$(gh pr checks "$PR_NUMBER" --json name,conclusion \
    --jq '.[] | select(.conclusion == "FAILURE") | .name')

# å„å¤±æ•—ã«å¯¾ã—ã¦ä¿®æ­£ã‚’è©¦ã¿ã‚‹
for CHECK in $FAILED_CHECKS; do
    case "$CHECK" in
        *"Lint"*|*"Format"*)
            echo "ğŸ“ ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒ»Lintä¿®æ­£..."
            pnpm format
            pnpm lint:fix
            ;;
        *"TypeCheck"*)
            echo "ğŸ” å‹ã‚¨ãƒ©ãƒ¼åˆ†æ..."
            pnpm typecheck 2>&1 | head -20
            echo "ğŸ’¡ æ‰‹å‹•ä¿®æ­£ãŒå¿…è¦ã§ã™"
            ;;
        *"Test"*)
            echo "ğŸ§ª ãƒ†ã‚¹ãƒˆå¤±æ•—åˆ†æ..."
            pnpm test 2>&1 | grep -A5 "FAIL"
            ;;
    esac
done

# ä¿®æ­£ãŒã‚ã‚Œã°ã‚³ãƒŸãƒƒãƒˆ
if [ -n "$(git status --porcelain)" ]; then
    git add .
    git commit -m "fix: CIæ¤œè¨¼ã‚¨ãƒ©ãƒ¼ã®è‡ªå‹•ä¿®æ­£"
    git push
    echo "âœ… ä¿®æ­£ã‚’ãƒ—ãƒƒã‚·ãƒ¥ã—ã¾ã—ãŸ"
else
    echo "â„¹ï¸  è‡ªå‹•ä¿®æ­£ã§ãã‚‹å•é¡Œã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ"
fi
```

## é–¢é€£ã‚³ãƒãƒ³ãƒ‰

- [`/ci/check`](check.md) - CIçŠ¶æ…‹ç¢ºèª
- [`/test/run`](../test/run.md) - ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- [`/pr/create`](../pr/create.md) - PRä½œæˆ
