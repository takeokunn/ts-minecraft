# UI System

UIシステムは、ホットバー、クロスヘア、ゲームメニューなどのゲーム情報をプレイヤーに表示する責務を担います。ECSの `World` の状態と、ユーザーが目にするHTML/DOM要素との間の橋渡しをします。

## 関連サービスとコンポーネント

UIシステムは、ECSコンポーネントを直接クエリするのではなく、主に `GameState` サービスを介してUIに関連する状態を取得します。

-   **`GameState` サービス**: ゲームの全体的な状態（例: `Title`, `InGame`, `Paused`）や、UIに表示する必要のある集約された状態を保持します。
    -   **`hotbar`**: `GameState` 内に保持されるオブジェクトで、プレイヤーのホットバーの状態を含みます。
        -   `slots`: ホットバー内のアイテムを表す `BlockType` の配列。
        -   `selectedSlot`: 現在選択されているスロットのインデックス。
-   **`Target` コンポーネント**: プレイヤーエンティティにこのコンポーネントが存在する場合、プレイヤーがブロックを見つめていることを示します。これはクロスヘアの見た目を変更するなどのUIフィードバックに使用できます（現在の `uiSystem` では未実装）。

## `uiSystem` の責務

UIロジックは `src/systems/ui.ts` に実装された `uiSystem` が担当します。このシステムは `GameState` サービスから状態を読み取り、DOMを直接操作してUIを更新します。

### 処理フロー

1.  **`GameState` の取得**: `GameState` サービスにアクセスし、現在のゲーム状態（特にホットバーの状態）を取得します。
2.  **DOM要素の更新**: 取得した状態に基づいて、対応するDOM要素を更新します。
    -   **ホットバーのレンダリング**: 9つのホットバースロット（`slot1` から `slot9` のIDを持つHTML要素）をループ処理します。
    -   **テクスチャの表示**: 各スロットに対応する `BlockType` が存在する場合、そのブロックのテクスチャ画像（例: `/assets/grass/side.jpeg`）をスロット要素の `backgroundImage` として設定します。これにより、ホットバーにブロックのアイコンが表示されます。
    -   **選択スロットのハイライト**: 現在選択されているスロットのインデックスとループのインデックスが一致する場合、そのDOM要素に `selected` CSSクラスを追加して視覚的にハイライトします。それ以外のスロットからは `selected` クラスを削除します。

### アーキテクチャ

現在の実装では、`uiSystem` が直接DOMを操作しています。これは、UIの更新ロジックが比較的シンプルであるため、サービスを介さずに直接実装するアプローチが取られています。将来的にUIが複雑化した場合、DOM操作を `infrastructure` 層の専用サービスに委譲するアーキテクチャに変更される可能性があります。

## ゲームの状態とメニュー

UIシステムは、メインメニュー、ゲーム内HUD、ポーズメニューなど、異なるゲームシーン間の切り替えにも関与します。

-   **`GameState` サービス**: `uiSystem` は `GameState` サービスを監視し、現在のシーン（`Title`, `InGame`, `Paused`）に応じて表示するUIを切り替えます。
-   **UIイベント**: メニューボタンなどのインタラクションは、`src/infrastructure/ui.ts` でDOMイベントリスナーとして処理されます。
-   **状態遷移**: ユーザーが「New Game」ボタンをクリックすると、イベントリスナーが `GameState` サービスのメソッドを呼び出し、ゲームの状態を `InGame` に遷移させます。これにより、メインのゲームループが開始され、HUDが表示されるようになります。
