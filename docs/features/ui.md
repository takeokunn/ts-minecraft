# 機能仕様: UI (User Interface)

このドキュメントは、ゲームのUI要素、特にHUD（ヘッズアップディスプレイ）の更新と、UIイベントの処理に関するアーキテクチャを定義します。

## 1. UIアーキテクチャ

UIは、ゲームの3Dワールドとは独立したHTML DOM要素としてレンダリングされます。責務は以下のように分離されています。

-   **`systems/ui.ts` (`uiSystem`)**:
    -   **UIの状態をDOMに反映する**責務を持ちます。
    -   現在は、`GameState` サービスからホットバーの状態（スロットの内容と選択中のスロット）を読み取り、対応するHTML要素のスタイル（背景画像やCSSクラス）を直接操作します。
    -   このシステムは定期的に（現在は100msごと）実行され、ゲームの状態とUIの表示を同期させます。

-   **`infrastructure/ui.ts` (`UILive`)**:
    -   **DOMからのイベントをゲーム内に伝達する**責務を持ちます。
    -   タイトル画面の「New Game」ボタンや、ポーズ画面の「Save Game」ボタンなどのHTML要素にイベントリスナーを登録します。
    -   これらのイベントが発生すると、それをEffectの`Stream`に変換して、アプリケーションの他の部分（主に`main.ts`）が購読できるように公開します。

-   **`main.ts`**:
    -   `UILive` から公開されたイベントストリームを購読し、それに応じてゲームの状態 (`GameState`) を変更したり、ワールドの初期化処理を呼び出したりします。
    -   ポインターロックの変更を監視し、`GameState` のシーン（`InGame` ⇔ `Paused`）を切り替えるロジックもここに実装されています。

## 2. HUDの更新 (`uiSystem`)

`uiSystem` は、ゲームプレイ中に表示されるHUD要素の更新を担当します。

-   **対象**: ホットバー (`#hotbar` 内の `#slot1`～`#slot9`)
-   **プロセス**:
    1.  `GameState` サービスから現在のホットバーの状態（`slots` 配列と `selectedSlot` インデックス）を取得します。
    2.  9つのスロット要素をループ処理します。
    3.  各スロットについて、`slots` 配列に対応するブロックタイプが存在すれば、そのブロックのテクスチャ画像（例: `/assets/grass/side.jpeg`）を背景として設定します。
    4.  インデックスが `selectedSlot` と一致するスロットには `selected` クラスを追加し、それ以外からは削除します。これにより、選択中のスロットがハイライトされます。

## 3. UIイベント処理の例 (New Game)

1.  **ユーザー操作**: プレイヤーがタイトル画面で「New Game」ボタンをクリックします。
2.  **`infrastructure/ui.ts`**:
    -   ボタンに登録されたクリックイベントリスナーが発火します。
    -   このイベントを `ui.events.newGame` という `Stream` にプッシュします。
3.  **`main.ts`**:
    -   `handleUIEvents` 関数内で `ui.events.newGame` ストリームを購読しています。
    -   イベントを受け取ると、`initializeNewGame` エフェクトを実行してワールドを生成し、`GameState` のシーンを `InGame` に変更し、ポインターロックを開始します。