# UIシステム (UI System)

UIシステムは、ホットバー、クロスヘア、ゲームメニューなど、ゲームの情報をプレイヤーに表示する責務を担います。ECSの `World` の状態や、より高レベルな `GameState` サービスと、ユーザーが目にするHTML/DOM要素との間の橋渡しをします。

## UIの状態管理

UIシステムは、エンティティのコンポーネントを直接クエリするのではなく、主に `GameState` サービスを集約された状態のソースとして利用します。

-   **`GameState` サービス**: ゲームの全体的な状態（例: `Title`, `InGame`, `Paused`）や、UIに表示する必要のある状態を保持します。
    -   **`hotbar`**: `GameState` 内に保持されるオブジェクトで、プレイヤーのホットバーの状態を含みます。
        -   `slots`: ホットバー内のアイテムを表す `BlockType` の配列。
        -   `selectedSlot`: 現在選択されているスロットのインデックス。

## `uiSystem` の責務

-   **ソース**: `src/systems/ui.ts`

UIのレンダリングロジックは `uiSystem` が担当します。このシステムは毎フレーム実行され、`GameState` サービスから最新の状態を読み取り、DOMを直接操作してUIを更新します。

### 処理フロー

1.  **`GameState` の取得**: `GameState` サービスにアクセスし、現在のゲーム状態（特にホットバーの状態）を取得します。
2.  **DOM要素の更新**: 取得した状態に基づいて、対応するDOM要素を更新します。
    -   **ホットバーのレンダリング**: 9つのホットバースロット（`slot1` から `slot9` のIDを持つHTML要素）をループ処理します。
    -   **テクスチャの表示**: 各スロットに対応する `BlockType` が存在する場合、そのブロックのテクスチャ画像（例: `/assets/grass/side.jpeg`）をスロット要素の `backgroundImage` として設定します。
    -   **選択スロットのハイライト**: 現在選択されているスロットのインデックスとループのインデックスが一致する場合、そのDOM要素に `selected` CSSクラスを追加して視覚的にハイライトします。それ以外のスロットからは `selected` クラスを削除します。

## UIイベントと状態遷移

UIの見た目を更新するのは `uiSystem` の役割ですが、ユーザーからの入力（クリックなど）を処理するのは `infrastructure` 層の役割です。

-   **イベントリスナー**: メニューボタンのクリックや、ゲームのロード/セーブといったUI操作のイベントリスナーは `src/infrastructure/ui.ts` に実装されています。
-   **状態遷移**: ユーザーが「New Game」ボタンをクリックすると、`infrastructure/ui.ts` のイベントリスナーが `GameState` サービスのメソッドを呼び出し、ゲームの状態を `Title` から `InGame` に遷移させます。
-   **分離**: このように、UIの「書き込み」（DOM更新）を `uiSystem` が、「読み取り」（イベント処理）を `infrastructure` 層が担当することで、関心の分離が図られています。

`uiSystem` は `GameState` のシーン（`Title`, `InGame`, `Paused`）を監視し、現在のシーンに応じて表示するUI（例: メインメニュー、HUD）を切り替える役割も担うことができます。