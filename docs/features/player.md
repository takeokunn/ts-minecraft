# プレイヤー (Player)

プレイヤーは、ユーザーがゲームワールドと対話するための中心的な存在です。このドキュメントでは、プレイヤーの操作がどのようにして実現されているか、特に入力処理、カメラ制御、移動ロジックの3つの独立したシステムがどのように連携するかに焦点を当てて解説します。

---

## 関連コンポーネント

プレイヤーエンティティは、以下のコンポーネントの組み合わせによってその状態と振る舞いが定義されます。

-   **`Player`**: エンティティをプレイヤーとして識別するためのタグコンポーネント。プレイヤーが地面に接しているかどうかの状態 `isGrounded` を保持します。
-   **`Position`**: 3D空間におけるエンティティの現在位置 (`x`, `y`, `z`)。
-   **`Velocity`**: エンティティの現在の速度と方向 (`dx`, `dy`, `dz`)。移動ロジックが主にこのコンポーネントを操作します。
-   **`InputState`**: `forward`, `backward`, `left`, `right`, `jump`, `sprint` など、プレイヤーの現在のキーボード入力のスナップショットを保持します。
-   **`CameraState`**: カメラの `pitch` (上下の傾き) と `yaw` (左右の回転) をラジアンで格納し、プレイヤーが見ている方向を決定します。
-   **`Collider`**: 衝突検知に使用される、エンティティの物理的なバウンディングボックス（AABB）を定義します。
-   **`Gravity`**: エンティティが重力の影響を受けることを示すコンポーネント。

---

## システムの連携

プレイヤーの操作は、単一の巨大なシステムではなく、責務が明確に分離された3つの小さなシステムによって実現されます。これにより、各ロジックの独立性とテスト容易性が高まっています。

各システムの詳細については、個別のドキュメントを参照してください。

### 1. [入力ポーリングシステム](./input-polling.md)

-   **責務**: キーボードとマウスの入力を `InputState` コンポーネントに反映します。

### 2. [カメラ制御システム](./camera-control.md)

-   **責務**: マウスの動きを `CameraState` コンポーネントに反映します。

### 3. [プレイヤー移動システム](./player-movement.md)

-   **責務**: `InputState` と `CameraState` を元に `Velocity` コンポーネントを計算します。

---

## データフロー

プレイヤー操作のデータは、毎フレーム明確な一方向のフローに従います。

```
[InputService] --(入力)--> [InputPollingSystem] & [CameraControlSystem]
      |
      v
[InputState] & [CameraState] --(読み取り)--> [PlayerMovementSystem] --(更新)--> [Velocity]
```

この分離されたパイプラインにより、各ロジックが独立して機能します。`PlayerMovementSystem` は入力デバイスのことを知る必要がなく、`InputState` と `CameraState` という純粋なデータにのみ依存します。

この後、`physicsSystem` と `collisionSystem` が、`PlayerMovementSystem` によって更新された `Velocity` を使って最終的な `Position` を計算し、プレイヤーをワールド内で実際に移動させます。