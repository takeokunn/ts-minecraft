# 機能仕様: 物理 (Physics)

このドキュメントは、ゲームワールド内のエンティティに作用する物理法則、特に重力に関する仕様を定義します。このロジックは `physicsSystem` が担当します。

## 1. 責務

`physicsSystem` の責務は非常に限定的です。それは、**重力の影響をエンティティの垂直方向の速度に適用すること**、ただそれだけです。

このシステムは、エンティティの位置（`Position`）を直接変更しません。また、水平方向の速度（摩擦や慣性）にも関与しません。あくまで、重力という単一の関心事に特化しています。

## 2. 対象コンポーネント

本システムは、以下のコンポーネントを両方持つエンティティを対象とします。

-   **`Velocity`**: エンティティの現在の速度ベクトル (`dx`, `dy`, `dz`) を保持します。
-   **`Gravity`**: エンティティに適用される重力加速度の強さ (`value`) を定義します。

## 3. 重力計算プロセス

`physicsSystem` はフレームごとに以下の処理を実行します。

1.  **クエリ**: `Velocity` と `Gravity` の両方のコンポーネントを持つすべてのエンティティを `World` から検索します。
2.  **速度更新**: 対象となる各エンティティに対して、現在のY軸方向の速度 (`vel.dy`) から重力値 (`grav.value`) を減算します。
    -   `newDy = currentDy - gravity`
3.  **終端速度 (Terminal Velocity)**:
    -   落下速度が無限に増加し続けるのを防ぐため、Y軸方向の速度には上限（下限）が設けられています。
    -   計算後の新しいY軸速度 (`newDy`) は、最大落下速度である `-2` に制限（`Math.max(-2, newDy)`）されます。
4.  **コンポーネント更新**: 計算後の新しい `Velocity` コンポーネントを `World` に書き戻します。

## 4. 重要な注意点: `Position` の更新について

`physicsSystem` は `Velocity` に基づいて `Position` を更新する**わけではありません**。

速度を位置に反映させ、ワールドのジオメトリとの衝突を解決する責務は、この後続の `collisionSystem` が担います。この関心の分離により、各システムはよりシンプルで予測可能になります。

-   `playerControlSystem`: プレイヤーの **意図** を `Velocity` に変換する。
-   `physicsSystem`: 重力という **環境要因** を `Velocity` に適用する。
-   `collisionSystem`: 最終的な `Velocity` を使って `Position` を計算し、**衝突解決** を行う。