# 使用技術 (Technologies)

本プロジェクトで採用している主要なライブラリ、フレームワーク、ツールについて解説します。

## 1. コアライブラリ

### [Effect](https://effect.website/)

- **役割**: アプリケーション全体のアーキテクチャの根幹。
- **概要**: TypeScriptのための関数型プログラミングエコシステム。単なるライブラリではなく、堅牢でスケーラブルなアプリケーションを構築するための包括的なフレームワークです。
- **採用理由**:
  - **副作用の厳密な管理**: ファイルI/O、DOM操作、ネットワークリクエストなどの副作用を `Effect` データ型にカプセル化することで、コードの大部分を純粋な関数として記述できます。これにより、ロジックのテスト容易性と予測可能性が劇的に向上します。
  - **構造化された並行処理**: `Fiber` をベースにした高度な並行・非同期処理を、`async/await` よりも安全かつ宣言的に記述できます。
  - **依存性注入 (DI)**: `Layer` と `Context` を用いた強力なDIシステムにより、サービス間の依存関係を明確にし、実装の差し替えを容易にします。
  - **エコシステム**: `Stream`, `Schedule`, `Ref`, `Queue` など、複雑なアプリケーションを構築するための豊富なツールが揃っています。

### [@effect/schema](https://effect.website/docs/guides/schema/schema)

- **役割**: データモデリングとバリデーション。
- **概要**: Effectエコシステムの一部であり、TypeScriptの型定義からランタイムのバリデーション、エンコード/デコードスキーマまでを一度に生成できる強力なツールです。
- **採用理由**:
  - **ECSのコンポーネント定義**: プロジェクトの核となるECSのコンポーネントはすべて`Schema.Class`を用いて定義されています。これにより、コンポーネントのデータ構造が静的にも動的にも保証されます。
  - **不変性の強制**: `Schema`から生成される型はデフォルトで`Readonly`であり、意図しないデータ変更を防ぎ、関数型プログラミングの原則をサポートします。
  - **セーブ/ロード機能**: ゲームの状態を保存・復元する際に、`Schema.encode`と`Schema.decode`を用いることで、安全で信頼性の高いシリアライズ・デシリアライズを実現しています。

### [Three.js](https://threejs.org/)

- **役割**: 3Dレンダリングエンジン。
- **概要**: WebGLを抽象化し、3Dシーン、カメラ、メッシュ、マテリアルなどを簡単に操作できるようにする、Webで最も広く使われている3Dライブラリです。
- **採用理由**:
  - **実績とコミュニティ**: 豊富なドキュメント、サンプル、そして巨大なコミュニティが存在し、問題解決が容易です。
  - **パフォーマンス**: `InstancedMesh` やジオメトリのマージなど、多数のオブジェクトを効率的に描画するための機能が充実しています。
  - **柔軟性**: ローレベルなWebGLの機能にもアクセス可能で、必要に応じたカスタマイズやシェーダーの記述も行えます。

## 2. 開発ツールとユーティリティ

### [Vite](https://vitejs.dev/)
- **役割**: フロントエンドのビルドツール兼開発サーバー。
- **採用理由**: HMR（ホットモジュールリプレースメント）による非常に高速な開発サイクルと、シンプルな設定でTypeScriptやReactなどのモダンな開発環境を構築できるため。

### [TypeScript](https://www.typescriptlang.org/)
- **役割**: 静的型付け言語。
- **採用理由**: 大規模なコードベースの保守性を高め、多くのエラーをコンパイル時に防ぐことができるため。Effect-TSの能力を最大限に活かす上で必須です。

### [Biome](https://biomejs.dev/) & [Oxlint](https://oxc-project.github.io/docs/linter/introduction.html)
- **役割**: コードフォーマッタとリンター。
- **採用理由**: Biomeによる自動フォーマットでコードスタイルを統一し、Oxlintによる高速な静的解析で潜在的なバグを検出します。これにより、コードの品質と一貫性を高く維持します。

### [ts-pattern](https://github.com/gvergnaud/ts-pattern)
- **役割**: パターンマッチングライブラリ。
- **概要**: TypeScriptで表現力豊かなパターンマッチングを実現します。
- **採用理由**: `src/infrastructure/input-browser.ts` において、キーボードの入力イベントを処理するために使用されています。`if/else`や`switch`文のネストを避けることができ、どのキーがどのアクションに対応するのかを宣言的かつ可読性高く記述できます。

### [simplex-noise](httpss://github.com/jwagner/simplex-noise.js) & [alea](https://www.npmjs.com/package/alea)
- **役割**: プロシージャルな地形生成。
- **概要**: `simplex-noise`はシンプレックスノイズを生成するためのライブラリ、`alea`はシード可能な乱数生成器(PRNG)です。パーリンノイズよりもアーティファクトが少ない高品質なノイズを生成します。
- **採用理由**: `src/systems/generation.ts` で見られるように、シンプレックスノイズを用いることで自然で滑らかな地形を生成しています。`alea`のようなシード可能な乱数生成器と組み合わせることで、同じシード値からは常に同じワールドが生成される、再現性のあるワールド生成を実現します。

## 3. テスティング

### [Vitest](https://vitest.dev/)
- **役割**: テストランナー。
- **概要**: Viteネイティブの高速なテストフレームワーク。Jestと互換性のあるAPIを持ち、設定が非常にシンプルです。
- **採用理由**:
  - **高速性**: Viteのエンジンを活用し、テストの実行とフィードバックが非常に高速です。
  - **設定の容易さ**: `vite.config.ts` を共有するため、テスト固有の複雑な設定が不要です。
  - **TypeScriptサポート**: TypeScriptをネイティブでサポートしています。

### [fast-check](https://fast-check.dev/)
- **役割**: プロパティベーステストライブラリ。
- **概要**: 事前に定義したプロパティ（不変条件）に基づき、ランダムなデータを大量に自動生成してテストを実行します。
- **採用理由**:
  - **網羅性の向上**: 開発者が思いつかないようなエッジケースを自動的に発見できます。
  - **堅牢性の保証**: 「どのような入力値であっても、この関数の結果は必ずこの条件を満たす」といった、システムの普遍的な正しさを保証するのに役立ちます。物理法則や状態遷移のテストに特に有効です。