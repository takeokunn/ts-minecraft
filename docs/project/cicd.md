# CI/CD パイプライン

本プロジェクトでは、コードの品質を維持し、デプロイを自動化するために、GitHub Actionsを用いたCI/CD（継続的インテグレーション/継続的デリバリー）パイプラインを構築しています。

-   **CI設定ファイル**: [`.github/workflows/ci.yml`](../../.github/workflows/ci.yml)
-   **CD設定ファイル**: [`.github/workflows/cd.yml`](../../.github/workflows/cd.yml)

---

## CI (継続的インテグレーション)

CIパイプラインは、コードの品質を自動的に検証するためのプロセスです。以下のタイミングで実行されます。

-   `main`ブランチ**以外**のブランチにプッシュされた時
-   CDワークフローから呼び出された時 (`workflow_call`)

### CIのチェック項目

CIワークフローでは、以下のジョブが順番に実行され、一つでも失敗するとパイプラインは停止します。

1.  **`oxlint`**: `pnpm lint`コマンドを実行し、Oxlintによる高速な静的解析を行います。コードの潜在的なバグや一貫性のないパターンを検出します。
2.  **`tsc`**: `pnpm exec tsc`コマンドを実行し、TypeScriptの型チェックを行います。型エラーがないことを保証します。
3.  **`test`**: `pnpm test`コマンドを実行し、Vitestによる単体テスト・プロパティベーステストを実行します。すべてのテストケースがパスすることを確認します。
4.  **`madge`**: `pnpm exec madge --circular --extensions ts ./src`コマンドを実行し、ソースコード内の循環依存をチェックします。循環依存は意図しない副作用やメンテナンス性の低下に繋がるため、これを防ぎます。
5.  **`biome`**: `pnpm format`コマンドを実行し、Biomeによるコードフォーマットが適用されているかチェックします。プロジェクト全体のコードスタイルを統一します。

すべてのチェックをパスすることが、`main`ブランチへのマージの必須条件です。

---

## CD (継続的デリバリー)

CDパイプラインは、`main`ブランチに新しいコードがマージされた際に、アプリケーションをビルドし、GitHub Pagesに自動的にデプロイするプロセスです。

### デプロイフロー

1.  **トリガー**: `main`ブランチへのプッシュ。
2.  **CIの実行**: まず、CDワークフローはCIワークフロー（`ci.yml`）を`uses`キーワードで呼び出し、`main`ブランチのコードがすべての品質チェックを満たしていることを再検証します。
3.  **ビルド**: CIが成功すると、`pnpm build`コマンドを実行し、本番環境向けの最適化された静的ファイル（HTML, CSS, JS）を`./public`ディレクトリに生成します。
4.  **デプロイ準備**:
    -   `actions/configure-pages@v4`: GitHub Pagesへのデプロイを設定します。
    -   `actions/upload-pages-artifact@v3`: ビルドで生成された`./public`ディレクトリを、デプロイ用のアーティファクトとしてアップロードします。
5.  **デプロイ**:
    -   `actions/deploy-pages@v4`: アップロードされたアーティファクトをGitHub Pagesにデプロイします。

このパイプラインにより、`main`ブランチは常にデプロイ可能な状態に保たれ、マージから公開までのプロセスが迅速かつ安全に自動化されています。
